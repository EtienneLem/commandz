!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.CommandZ=e():t.CommandZ=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var o,i=function(t,e){return function(){return t.apply(e,arguments)}};o=function(){function t(){this.handleKeypress=i(this.handleKeypress,this),this.VERSION="0.2.0",this.reset(),this.keyboardShortcuts(!0)}return t.prototype.reset=function(){return this.clear(),this.statusChangeCallback=null,this.storageChangeCallback=null,this.thresholdTimer=null,this.threshold=0},t.prototype.clear=function(){return this.history=[],this.index=-1},t.prototype.keyboardShortcuts=function(t){var e;return null==t&&(t=!0),e=t?"addEventListener":"removeEventListener",document[e]("keydown",this.handleKeypress)},t.prototype.handleKeypress=function(t){return"INPUT"!==document.activeElement.nodeName&&(90===t.which&&t.metaKey===!0||26===t.which&&t.ctrlKey===!0)?(t.preventDefault(),t.shiftKey?this.redo():this.undo()):void 0},t.prototype.execute=function(t){var e;return e={},e.command=t,this.up(t),this.addToHistory(e)},t.prototype.store=function(t){var e;return e={},e.data=t,this.addToHistory(e)},t.prototype.addToHistory=function(t){var e;return this.index<this.history.length-1&&(e=this.history.length-this.index-1,this.history.splice(-e)),this.history.push(t),this.index=this.history.length-1,this.handleStatusChange()},t.prototype.undo=function(t){var e,n,o,i,s,r;if(null==t&&(t=1),this.status().canUndo)for(i=s=1,r=t;r>=1?r>=s:s>=r;i=r>=1?++s:--s){if(!this.history[this.index])return;o=this.history[this.index],(e=o.command)&&this.down(e),this.index--,(o=this.history[this.index])&&(n=o.data)&&this.handleData(n),this.handleStatusChange()}},t.prototype.redo=function(t){var e,n,o,i,s,r;if(null==t&&(t=1),this.status().canRedo)for(i=s=1,r=t;r>=1?r>=s:s>=r;i=r>=1?++s:--s){if(!this.history[this.index+1])return;this.index++,o=this.history[this.index],(e=o.command)&&this.up(e),(n=o.data)&&this.handleData(n),this.handleStatusChange()}},t.prototype.exec=function(t,e){var n,o,i,s;if(!(e instanceof Array))return e[t]();for(s=[],o=0,i=e.length;i>o;o++)n=e[o],s.push(n[t]());return s},t.prototype.up=function(t){return this.exec("up",t)},t.prototype.down=function(t){return this.exec("down",t)},t.prototype.handleData=function(t){return this.threshold>0?(clearTimeout(this.thresholdTimer),this.thresholdTimer=setTimeout(function(e){return function(){return e.sendData(t)}}(this),this.threshold)):this.sendData(t)},t.prototype.sendData=function(t){return this.storageChangeCallback?this.storageChangeCallback(t):void 0},t.prototype.onStorageChange=function(t){return this.storageChangeCallback=t},t.prototype.setThreshold=function(t){return this.threshold=t},t.prototype.onStatusChange=function(t){return this.statusChangeCallback=t,this.handleStatusChange()},t.prototype.handleStatusChange=function(){return this.statusChangeCallback?this.statusChangeCallback(this.status()):void 0},t.prototype.status=function(){var t;return t=this.history[0],this.history.length?{canUndo:t.data?this.index>0:this.index>-1,canRedo:this.index<this.history.length-1}:{canUndo:!1,canRedo:!1}},t}(),t.exports=new o}])});
!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.CommandZ=n():t.CommandZ=n()}(this,function(){return function(t){function n(o){if(e[o])return e[o].exports;var i=e[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n){var e,o,i=function(t,n){return function(){return t.apply(n,arguments)}};e={},e.Client=function(){function t(){this.handleKeypress=i(this.handleKeypress,this),this.VERSION="0.2.0",this.reset(),this.keyboardShortcuts(!0)}return t.prototype.reset=function(){return this.clear(),this.statusChangeCallback=null,this.storageChangeCallback=null,this.thresholdTimer=null,this.threshold=0},t.prototype.clear=function(){return this.history=[],this.index=-1},t.prototype.keyboardShortcuts=function(t){var n;return null==t&&(t=!0),n=t?"addEventListener":"removeEventListener",document[n]("keydown",this.handleKeypress)},t.prototype.handleKeypress=function(t){var n;if(n=document.activeElement.nodeName,"INPUT"!==n&&"TEXTAREA"!==n&&(90===t.which&&t.metaKey===!0||26===t.which&&t.ctrlKey===!0))return t.preventDefault(),t.shiftKey?this.redo():this.undo()},t.prototype.execute=function(t){var n,i,r,s,h,a,u,c;if(Array.isArray(t)){for(c=0,u=[],r=s=0,a=t.length;s<a;r=++s)n=t[r],n&&(o(n)||n.up||n.down)?n instanceof e.Action?c++:(t[r]=new e.Action(n),t[r].up()):u.push(r);for(h=u.length-1;h>=0;h+=-1)r=u[h],t.splice(r,1);if(!t.length)return;c&&this.history.splice(-c),i=new e.Action(t)}else{if(!t||!o(t)&&!t.up&&!t.down)return;i=new e.Action(t),i.up()}return this.addToHistory(i)},t.prototype.store=function(t){return t=new e.Data(t),this.addToHistory(t)},t.prototype.addToHistory=function(t){var n;return this.index<this.history.length-1&&(n=this.history.length-this.index-1,this.history.splice(-n)),this.history.push(t),this.index=this.history.length-1,this.handleStatusChange(),t},t.prototype.undo=function(t){var n,o,i,r,s;if(null==t&&(t=1),n=this.status().canUndo)for(i=r=1,s=t;1<=s?r<=s:r>=s;i=1<=s?++r:--r){if(!(o=this.history[this.index]))return;o instanceof e.Action&&o.down(),this.index--,o=this.history[this.index],o instanceof e.Data&&this.handleData(o.data),this.handleStatusChange()}},t.prototype.redo=function(t){var n,o,i,r,s;if(null==t&&(t=1),n=this.status().canRedo)for(i=r=1,s=t;1<=s?r<=s:r>=s;i=1<=s?++r:--r){if(!this.history[this.index+1])return;this.index++,o=this.history[this.index],o instanceof e.Action&&o.up(),o instanceof e.Data&&this.handleData(o.data),this.handleStatusChange()}},t.prototype.handleData=function(t){return this.threshold>0?(clearTimeout(this.thresholdTimer),this.thresholdTimer=setTimeout(function(n){return function(){return n.sendData(t)}}(this),this.threshold)):this.sendData(t)},t.prototype.sendData=function(t){if(this.storageChangeCallback)return this.storageChangeCallback(t)},t.prototype.onStorageChange=function(t){return this.storageChangeCallback=t},t.prototype.setThreshold=function(t){return this.threshold=t},t.prototype.onStatusChange=function(t){return this.statusChangeCallback=t,this.handleStatusChange()},t.prototype.handleStatusChange=function(){if(this.statusChangeCallback)return this.statusChangeCallback(this.status())},t.prototype.status=function(){var t,n;return n=this.history[0],this.history.length?(t=n instanceof e.Action?-1:0,{canUndo:this.index>t,canRedo:this.index<this.history.length-1}):{canUndo:!1,canRedo:!1}},t}(),e.Action=function(){function t(t){this.actions=t,Array.isArray(this.actions)||(this.actions=[this.actions])}return t.prototype.up=function(){return this.upDown("up")},t.prototype.down=function(){return this.upDown("down")},t.prototype.upDown=function(t){var n,e,i,r,s;for(r=this.actions,s=[],e=0,i=r.length;e<i;e++)n=r[e],n&&(o(n)?s.push(n.call()):o(n[t])?s.push(n[t]()):s.push(void 0));return s},t}(),e.Data=function(){function t(t){this.data=t}return t}(),o="function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof document.childNodes?function(t){return"function"==typeof t}:function(t){return"[object Function]"===toString.call(action)},t.exports=new e.Client}])});
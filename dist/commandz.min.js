!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):"object"==typeof exports?exports.CommandZ=n():t.CommandZ=n()}(this,function(){return function(t){function n(i){if(e[i])return e[i].exports;var o=e[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){var i,o=function(t,n){return function(){return t.apply(n,arguments)}};i={},i.Client=function(){function t(){this.handleKeypress=o(this.handleKeypress,this),this.VERSION="0.2.0",this.reset(),this.keyboardShortcuts(!0)}return t.prototype.reset=function(){return this.clear(),this.statusChangeCallback=null,this.storageChangeCallback=null,this.thresholdTimer=null,this.threshold=0},t.prototype.clear=function(){return this.history=[],this.index=-1},t.prototype.keyboardShortcuts=function(t){var n;return null==t&&(t=!0),n=t?"addEventListener":"removeEventListener",document[n]("keydown",this.handleKeypress)},t.prototype.handleKeypress=function(t){return"INPUT"!==document.activeElement.nodeName&&(90===t.which&&t.metaKey===!0||26===t.which&&t.ctrlKey===!0)?(t.preventDefault(),t.shiftKey?this.redo():this.undo()):void 0},t.prototype.execute=function(t){var n,e,o,s,r,h;if(Array.isArray(t)){for(h=0,o=s=0,r=t.length;r>s;o=++s)n=t[o],n instanceof i.Action?h++:(t[o]=new i.Action(n),t[o].up());h&&this.history.splice(-h),e=new i.Action(t)}else e=new i.Action(t),e.up();return this.addToHistory(e)},t.prototype.store=function(t){return t=new i.Data(t),this.addToHistory(t)},t.prototype.addToHistory=function(t){var n;return this.index<this.history.length-1&&(n=this.history.length-this.index-1,this.history.splice(-n)),this.history.push(t),this.index=this.history.length-1,this.handleStatusChange(),t},t.prototype.undo=function(t){var n,e,o,s,r;if(null==t&&(t=1),n=this.status().canUndo)for(o=s=1,r=t;r>=1?r>=s:s>=r;o=r>=1?++s:--s){if(!(e=this.history[this.index]))return;e instanceof i.Action&&e.down(),this.index--,e=this.history[this.index],e instanceof i.Data&&this.handleData(e.data),this.handleStatusChange()}},t.prototype.redo=function(t){var n,e,o,s,r;if(null==t&&(t=1),n=this.status().canRedo)for(o=s=1,r=t;r>=1?r>=s:s>=r;o=r>=1?++s:--s){if(!this.history[this.index+1])return;this.index++,e=this.history[this.index],e instanceof i.Action&&e.up(),e instanceof i.Data&&this.handleData(e.data),this.handleStatusChange()}},t.prototype.handleData=function(t){return this.threshold>0?(clearTimeout(this.thresholdTimer),this.thresholdTimer=setTimeout(function(n){return function(){return n.sendData(t)}}(this),this.threshold)):this.sendData(t)},t.prototype.sendData=function(t){return this.storageChangeCallback?this.storageChangeCallback(t):void 0},t.prototype.onStorageChange=function(t){return this.storageChangeCallback=t},t.prototype.setThreshold=function(t){return this.threshold=t},t.prototype.onStatusChange=function(t){return this.statusChangeCallback=t,this.handleStatusChange()},t.prototype.handleStatusChange=function(){return this.statusChangeCallback?this.statusChangeCallback(this.status()):void 0},t.prototype.status=function(){var t,n;return n=this.history[0],this.history.length?(t=n instanceof i.Action?-1:0,{canUndo:this.index>t,canRedo:this.index<this.history.length-1}):{canUndo:!1,canRedo:!1}},t}(),i.Action=function(){function t(t){this.actions=t,Array.isArray(this.actions)||(this.actions=[this.actions])}return t.prototype.up=function(){return this.upDown("up")},t.prototype.down=function(){return this.upDown("down")},t.prototype.upDown=function(t){var n,e,i,o,s;for(o=this.actions,s=[],e=0,i=o.length;i>e;e++)n=o[e],s.push(n[t]());return s},t}(),i.Data=function(){function t(t){this.data=t}return t}(),t.exports=new i.Client}])});